defaultValues:
  - ./confz.d/defaults.js
values:
  - ./config
valuesSchema:
  additionalProperties: false
  definitions:
    16BitInteger:
      type: integer
      minimum: 0
      maximum: 65535
    block:
      type: integer
      minimum: 0
      maximum: 9999999
    hexId:
      type: string
      pattern: '^[0-9a-fA-F]{64}$'
    hostname:
      type: string
      format: hostname
    ipAddressAndPort:
      type: string
      pattern: '^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?):(102[5-9]|10[3-9][0-9]|1[1-9][0-9]{2}|[2-9][0-9]{3}|[1-5][0-9]{4}|6[1-4][0-9]{3}|65[1-4][0-9]{2}|655[1-2][0-9]|6553[1-5])$'
    pemData:
      type: string
      pattern: '^-{5}BEGIN((?: [A-Z]+)*)-{5}(\r?\n)(?:(?:[A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?\2)+-{5}END\1-{5}\2?$'
    tcpPort:
      type: integer
      minimum: 1025
      maximum: 65535
    uri:
      type: string
      format: uri
  dependencies:
    apiPassword:
      - apiUser
    apiUser:
      - apiPassword
    authorityServerPrivateKey:
      - authorityServerPublicKey
    authorityServerPublicKey:
      - authorityServerPrivateKey
    tlsPrivateKey:
      - tlsPublicCert
    tlsPublicCert:
      - tlsPrivateKey
  properties:
    apiPassword:
      type: string
      description: 'The basic authentication password for the API and Control Panel ports. [FactomdRpcPass]'
    apiPort:
      allOf:
        - $ref: '#/definitions/tcpPort'
      description: 'The API server listen port. [PortNumber]'
    apiUser:
      type: string
      description: 'The basic authentication username for the API and Control Panel ports. [FactomdRpcUser]'
    authorityServerPrivateKey:
      allOf:
        - $ref: '#/definitions/hexId'
      description: '[LocalServerPrivKey]'
    authorityServerPublicKey:
      allOf:
        - $ref: '#/definitions/hexId'
      description: '[LocalServerPublicKey]'
    brainSwapHeight:
      allOf:
        - $ref: '#/definitions/block'
      description: 'The block height at which a brain swap will occur. [ChangeAcksHeight]'
    broadcastNumber:
      allOf:
        - $ref: '#/definitions/16BitInteger'
      minimum: 1
      description: 'Number of peers to broadcast to in the peer to peer networking. [broadcastnum]'
    controlPanelMode:
      type: string
      enum:
        - disabled
        - readonly
        - readwrite
      description: 'Controls the behavior of the control panel. [ControlPanelSetting]'
    controlPanelPort:
      allOf:
        - $ref: '#/definitions/tcpPort'
      description: 'The Control Panel server listen port. [ControlPanelPort]'
    corsDomains:
      type: array
      items:
        type: string
      minItems: 1
      uniqueItems: true
      oneOf:
        - items:
            const: '*'
          maxItems: 1
        - items:
            $ref: '#/definitions/hostname'
      description: 'Configures CORS for the API port. Accepts one or more allowed hostnames or a single wildcard `*`. [CorsDomains]'
    customBootstrapIdentity:
      allOf:
        - $ref: '#/definitions/hexId'
      description: 'The bootstrap identity used when `network: custom` is enabled. [CustomBootstrapIdentity]'
    customBootstrapKey:
      allOf:
        - $ref: '#/definitions/hexId'
      description: 'The bootstrap key used when `network: custom` is enabled. [CustomBootstrapKey]'
    customExchangeRateAuthorityPublicKey:
      allOf:
        - $ref: '#/definitions/hexId'
      description: 'The exchange rate key used when `network: custom` is enabled. [ExchangeRateAuthorityPublicKey]'
    customNetworkId:
      type: string
      maxLength: 20
      description: 'The network id used when `network: custom` is enabled. [customnet]'
    customNetworkPort:
      allOf:
        - $ref: '#/definitions/tcpPort'
      description: 'The peer-to-peer port used when `network: custom` is enabled. [CustomNetworkPort]'
    customSeedUrl:
      allOf:
        - $ref: '#/definitions/uri'
      description: 'The seed URL used when `network: custom` is enabled. [CustomSeedURL]'
    customSpecialPeers:
      type: array
      items:
        $ref: '#/definitions/ipAddressAndPort'
      minItems: 1
      uniqueItems: true
      description: 'The special peers list used when `network: custom` is enabled. [CustomSpecialPeers]'
    directoryBlockInSeconds:
      allOf:
        - $ref: '#/definitions/16BitInteger'
      description: 'The length of the directory block. [DirectoryBlockInSeconds]'
    fastBoot:
      type: boolean
      description: '[FastBoot]'
    faultTimeoutInSeconds:
      allOf:
        - $ref: '#/definitions/16BitInteger'
      description: 'Seconds before Federated servers are considered at-fault. [faulttimeout]'
    identityChainId:
      allOf:
        - $ref: '#/definitions/hexId'
      description: 'Identification chain for the server. [IdentityChainID]'
    localNetworkPort:
      allOf:
        - $ref: '#/definitions/tcpPort'
      description: 'The peer-to-peer port used when `network: local` is enabled. [LocalNetworkPort]'
    localSeedUrl:
      allOf:
        - $ref: '#/definitions/uri'
      description: 'The seed URL used when `network: local` is enabled. [LocalSeedURL]'
    localSpecialPeers:
      type: array
      items:
        $ref: '#/definitions/ipAddressAndPort'
      minItems: 1
      uniqueItems: true
      description: 'The special peers list used when `network: local` is enabled. [LocalSpecialPeers]'
    logLevel:
      type: string
      enum:
        - none
        - debug
        - info
        - warning
        - error
        - fatal
        - panic
      description: 'Controls the verbosity of log output. [loglvl]'
    mainNetworkPort:
      allOf:
        - $ref: '#/definitions/tcpPort'
      description: 'The peer-to-peer port used when `network: main` is enabled. [MainNetworkPort]'
    mainSeedUrl:
      type: string
      format: uri
      description: 'The seed URL used when `network: main` is enabled. [MainSeedURL]'
    mainSpecialPeers:
      type: array
      items:
        $ref: '#/definitions/ipAddressAndPort'
      minItems: 1
      uniqueItems: true
      description: 'The special peers list used when `network: main` is enabled. [MainSpecialPeers]'
    network:
      type: string
      enum:
        - custom
        - local
        - main
        - test
      description: 'The network to connect to. [Network]'
    networkProfile:
      type: string
      enum:
        - mainnet
        - testnet
      description: ''
    nodeName:
      type: string
      description: '[nodename]'
    roleProfile:
      type: string
      enum:
        - authority
        - follower
      description: ''
    specialPeersDialOnly:
      type: boolean
      description: 'Only dial out to nodes on the special peers list. [exclusive]'
    specialPeersOnly:
      type: boolean
      description: 'Only communicate with nodes on the special peers list. [exclusiveIn]'
    startDelayInSeconds:
      type: integer
      minimum: 0
      description: '[startdelay]'
    testNetworkPort:
      allOf:
        - $ref: '#/definitions/tcpPort'
      description: 'The peer-to-peer port used when `network: test` is enabled. [TestNetworkPort]'
    testSeedUrl:
      type: string
      format: uri
      description: 'The seed URL used when `network: test` is enabled. [TestSeedURL]'
    testSpecialPeers:
      type: array
      items:
        $ref: '#/definitions/ipAddressAndPort'
      minItems: 1
      uniqueItems: true
      description: 'The special peers list used when `network: test` is enabled. [TestSpecialPeers]'
    tlsEnabled:
      type: boolean
      description: '[FactomdTlsEnabled]'
    tlsPrivateKey:
      allOf:
        - $ref: '#/definitions/pemData'
      description: '[FactomdTlsPrivateKey]'
    tlsPublicCert:
      allOf:
        - $ref: '#/definitions/pemData'
      description: '[FactomdTlsPublicCert]'
  required:
    - identityChainId
    - network
  type: object
