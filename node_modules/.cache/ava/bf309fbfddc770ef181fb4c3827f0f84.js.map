{"version":3,"sources":["test/configTests.js"],"names":["test","require","decode","matchAll","getFileFromContainer","DEFAULT_CONFIG","network","mergeConfig","config","getOptions","factomdConf","app","getArgs","startupScript","result","exec","console","log","optionTest","yamlName","optionName","valueOverride","t","options","is","argTest","argName","args","apiPassword","apiUser","apiPort","faultTimeoutInSeconds"],"mappings":";;AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAC,KAAD,CAApB;;AACA,MAAM;AAACC,EAAAA;AAAD,IAAWD,OAAO,CAAC,KAAD,CAAxB;;AACA,MAAME,QAAQ,GAAGF,OAAO,CAAC,WAAD,CAAxB;;AAEA,MAAM;AAACG,EAAAA;AAAD,IAAyBH,OAAO,CAAC,QAAD,CAAtC;;AAEA,MAAMI,cAAc,GAAG;AACrBC,EAAAA,OAAO,EAAE;AADY,CAAvB;;AAIA,MAAMC,WAAW,GAAGC,MAAM,KAAK,EAC7B,GAAGH,cAD0B;AAE7B,KAAGG;AAF0B,CAAL,CAA1B;;AAKA,MAAMC,UAAU,GAAG,MAAMD,MAAN,IAAgB;AACjC,QAAME,WAAW,GAAG,MAAMN,oBAAoB,CAAC,cAAD,EAAiBG,WAAW,CAACC,MAAD,CAA5B,CAA9C;AACA,SAAON,MAAM,CAACQ,WAAD,CAAN,CAAoBC,GAA3B;AACD,CAHD;;AAKA,MAAMC,OAAO,GAAG,MAAMJ,MAAN,IAAgB;AAC9B,QAAMK,aAAa,GAAG,MAAMT,oBAAoB,CAAC,UAAD,EAAaG,WAAW,CAACC,MAAD,CAAxB,CAAhD;AACA,QAAMM,MAAM,GAAG,2BAA2BC,IAA3B,CAAgCF,aAAhC,CAAf;AACAG,EAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBH,MAAtB;AAED,CALD;;AAOA,MAAMI,UAAU,GAAG,CAACC,QAAD,EAAWC,UAAX,EAAuBZ,MAAvB,EAA+Ba,aAA/B,KAAiDrB,IAAI,CAAE,GAAEmB,QAAS,OAAMC,UAAW,EAA9B,EAAiC,MAAME,CAAN,IAAW;AAClH,QAAMC,OAAO,GAAG,MAAMd,UAAU,CAACD,MAAD,CAAhC;AACAc,EAAAA,CAAC,CAACE,EAAF,CAAKH,aAAa,IAAIb,MAAM,CAACW,QAAD,CAA5B,EAAwCI,OAAO,CAACH,UAAD,CAA/C;AACD,CAHuE,CAAxE;;AAKA,MAAMK,OAAO,GAAG,CAACN,QAAD,EAAWO,OAAX,EAAoBlB,MAApB,EAA4Ba,aAA5B,KAA8CrB,IAAI,CAAE,GAAEmB,QAAS,OAAMO,OAAQ,EAA3B,EAA8B,MAAMJ,CAAN,IAAW;AACzG,QAAMK,IAAI,GAAG,MAAMf,OAAO,CAACJ,MAAD,CAA1B;AACAc,EAAAA,CAAC,CAACE,EAAF,CAAKH,aAAa,IAAIb,MAAM,CAACW,QAAD,CAA5B,EAAwCQ,IAAI,CAACD,OAAD,CAA5C;AACD,CAHiE,CAAlE;;AAKAR,UAAU,CAAC,aAAD,EAAgB,gBAAhB,EAAkC;AAACU,EAAAA,WAAW,EAAE,UAAd;AAA0BC,EAAAA,OAAO,EAAE;AAAnC,CAAlC,CAAV;AACAX,UAAU,CAAC,SAAD,EAAY,YAAZ,EAA0B;AAACY,EAAAA,OAAO,EAAE;AAAV,CAA1B,EAA2C,MAA3C,CAAV;AACAZ,UAAU,CAAC,SAAD,EAAY,gBAAZ,EAA8B;AAACU,EAAAA,WAAW,EAAE,UAAd;AAA0BC,EAAAA,OAAO,EAAE;AAAnC,CAA9B,CAAV;AACAJ,OAAO,CAAC,uBAAD,EAA0B,cAA1B,EAA0C;AAACM,EAAAA,qBAAqB,EAAE;AAAxB,CAA1C,CAAP","sourceRoot":"/Users/jay/code/factomd-docker","sourcesContent":["const test = require('ava')\nconst {decode} = require('ini')\nconst matchAll = require('match-all')\n\nconst {getFileFromContainer} = require('./util')\n\nconst DEFAULT_CONFIG = {\n  network: 'main',\n}\n\nconst mergeConfig = config => ({\n  ...DEFAULT_CONFIG,\n  ...config,\n})\n\nconst getOptions = async config => {\n  const factomdConf = await getFileFromContainer('factomd.conf', mergeConfig(config))\n  return decode(factomdConf).app\n}\n\nconst getArgs = async config => {\n  const startupScript = await getFileFromContainer('start.sh', mergeConfig(config))\n  const result = /-([a-z]+)=(\"?[^ \\\"]+\"?)/g.exec(startupScript)\n  console.log('result', result)\n\n}\n\nconst optionTest = (yamlName, optionName, config, valueOverride) => test(`${yamlName} -> ${optionName}`, async t => {\n  const options = await getOptions(config)\n  t.is(valueOverride || config[yamlName], options[optionName])\n})\n\nconst argTest = (yamlName, argName, config, valueOverride) => test(`${yamlName} -> ${argName}`, async t => {\n  const args = await getArgs(config)\n  t.is(valueOverride || config[yamlName], args[argName])\n})\n\noptionTest('apiPassword', 'FactomdRpcPass', {apiPassword: 'password', apiUser: 'username'})\noptionTest('apiPort', 'PortNumber', {apiPort: 1234}, '1234')\noptionTest('apiUser', 'FactomdRpcUser', {apiPassword: 'password', apiUser: 'username'})\nargTest('faultTimeoutInSeconds', 'faulttimeout', {faultTimeoutInSeconds: 123})\n"]}